---
- name: Install mail packages
  homebrew: name={{ item }} state=latest
  with_items:
    - dovecot
    - isync
    - mutt
    - notmuch
    - offlineimap
  tags: update

- name: Create ~/Mail directory
  file: dest=~/Mail mode=0700 state=directory

- name: Decrypt encrypted configuration files
  command: >-
    gpg -o ~/.{{ item | basename | regex_replace('\.gpg$', '') }} --decrypt {{ item }}
    creates=~/.{{ item | basename | regex_replace('\.gpg$', '') }}
  with_fileglob:
    - ./*.gpg
