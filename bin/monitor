#!/usr/bin/env ruby
# encoding: utf-8

# http://gist.github.com/407922

unless (@file = ARGV.first) && File.exist?(@file)
  $stderr.puts "Usage: #{File.basename(__FILE__)} file"
  exit 1
end

require 'benchmark'
puts "Loading most of Railsâ€¦"

time = Benchmark.measure do
  require 'active_support/core_ext'
  require 'action_view/helpers/number_helper'
  I18n.load_path << File.expand_path('../action_view/locale/en.yml', `gem which action_view`.strip)
end.format('%r').gsub(%r{\(|\)}, '')

puts "And it only took \033[33m#{time}\033[0m seconds :)", ''

include ActionView::Helpers::NumberHelper


trap('INT') do
  puts "\rFinal size of #{File.basename(@file)} is #{human_size}"
  exit
end

def human_size
  size = File.size(@file)
  number_to_human_size(size, :precision => 2)
end

while true
  printf "\rFile size: \033[33m%s\033[0m", human_size
  $stdout.flush
  sleep 1
end
